<ion-header class="ion-no-border">

  <ion-toolbar>

    <ion-title *ngIf="slideActiveIndex == 0">Bem vindo!</ion-title>

    <ion-title *ngIf="slideActiveIndex == 1">Planos</ion-title>

    <ion-title *ngIf="slideActiveIndex == 2">Cartão de crédito</ion-title>

  </ion-toolbar>

</ion-header>

<ion-content customScroll>

  <ion-slides class="swiper-no-swiping">

    <ion-slide class="welcome">

      <ion-list class="ion-padding-horizontal">

        <ion-item lines="none">

          <ion-icon src="../../../assets/icon/support.svg"></ion-icon>
          
        </ion-item>

        <ion-item class="ion-text-center" lines="none">

          <ion-label class="ion-text-wrap">Seu cadastrado foi realizado com sucesso em nossa plataforma, agora é a vez de escolher o
            plano de sua conta.</ion-label>

        </ion-item>

      </ion-list>

    </ion-slide>

    <ion-slide class="plans">

      <ion-list>

        <ion-radio-group mode="md" [(ngModel)]="selectedPlanIndex">

          <ion-item lines="full" detail="false" *ngFor="let plan of plans; let i=index">

            <ion-radio slot="start" [value]="i"></ion-radio>

            <ion-label class="ion-text-wrap">

              <h6>{{ plan.name }}</h6>

              <p>Gestão completa para {{ plan.limit_companies }} Restaurante<span
                  *ngIf="plan.limit_companies > 1">s</span></p>

              <p *ngIf="plan.digital_menu">Cardápio Digital</p>

              <h6>{{ plan.price | money }}/mês</h6>

            </ion-label>

          </ion-item>

        </ion-radio-group>

      </ion-list>

    </ion-slide>

    <ion-slide class="payment">

      <form [formGroup]="formGroupCard" [hidden]="slideActiveIndex != 2">

        <ion-grid class="ion-padding-horizontal">

          <ion-row>

            <ion-col size-xs="12" size-sm="6">

              <ion-label class="stacked" [class.invalid]="formControl.number.errors?.cardNumber">Número do cartão</ion-label>

              <ion-input [class.invalid]="formControl.number.errors?.cardNumber" inputmode="numeric" formControlName="number" maxlength="19" [brmasker]="{ mask: '0000 0000 0000 0000', type: 'num' }" (keyup)="guessPaymentMethod()" (ionBlur)="guessPaymentMethod()">

                <img [src]="paymentMethod?.secure_thumbnail">

              </ion-input>

              <ion-note class="validation-error" *ngIf="formControl.number.errors?.cardNumber">

                <ion-icon name="information-circle-outline"></ion-icon>
                
                Método de pagamento não encontrado.
              
              </ion-note>

            </ion-col>

            <ion-col size-xs="12" size-sm="4">

              <ion-label class="stacked" [class.invalid]="formControl.expiration.errors?.cardExpiration">Data de validade</ion-label>

              <ion-input [class.invalid]="formControl.expiration.errors?.cardExpiration" inputmode="numeric" formControlName="expiration" maxlength="7" [brmasker]="{ mask: '00/0000', type: 'num' }" (ionBlur)="checkExpiration()"></ion-input>

              <ion-note class="validation-error" *ngIf="formControl.expiration.errors?.cardExpiration">

                <ion-icon name="information-circle-outline"></ion-icon>
                
                Data inválida.
              
              </ion-note>

            </ion-col>

            <ion-col size-xs="12" size-sm="2">

              <ion-label class="stacked">CVV</ion-label>

              <ion-input inputmode="numeric" formControlName="security_code" maxlength="4" [brmasker]="{ mask: '0000', type: 'num' }"></ion-input>

            </ion-col>

            <ion-col size-xs="12" size-sm="6">

              <ion-label class="stacked">Nome do titular</ion-label>

              <ion-input formControlName="holder_name"></ion-input>

            </ion-col>

            <ion-col size-xs="12" size-sm="6">

              <ion-label class="stacked" [class.invalid]="formControl.holder_document_number.errors?.documentNumber">CPF/CNPJ do titular</ion-label>

              <ion-input [class.invalid]="formControl.holder_document_number.errors?.documentNumber" formControlName="holder_document_number" [brmasker]="{ person: true }" (ionBlur)="checkDocumentNumber()"></ion-input>

              <ion-note class="validation-error" *ngIf="formControl.holder_document_number.errors?.documentNumber">

                <ion-icon name="information-circle-outline"></ion-icon>
                
                CPF/CNPJ inválido.
              
              </ion-note>

            </ion-col>

            <ion-col class="ion-margin-top" size="12">

              <ion-card class="ion-no-margin">

                <ion-item lines="none">

                  <ion-label *ngIf="selectedPlanIndex !== undefined">

                    <h6>{{ plans[selectedPlanIndex].name }}</h6>

                    <h6>{{ plans[selectedPlanIndex].price | money }}</h6>

                  </ion-label>

                  <ion-button fill="clear" (click)="previous()">Trocar</ion-button>

                </ion-item>

              </ion-card>

            </ion-col>

          </ion-row>

        </ion-grid>

      </form>

    </ion-slide>

    <ion-slide class="payment-success">

      <ion-grid class="ion-padding-horizontal">

        <ion-row>

          <ion-col class="ion-text-center" size="12">

            <ion-icon src="../../../assets/icon/success.svg"></ion-icon>

            <p class="ion-padding-horizontal">Pagamento realizado com sucesso! Comece agora mesmo a adicionar seus
              restaurantes.</p>

          </ion-col>

        </ion-row>

      </ion-grid>

    </ion-slide>

  </ion-slides>

</ion-content>

<ion-footer>

  <ion-grid class="ion-padding">

    <ion-row>

      <ion-col size="12">

        <ion-button expand="block" (click)="next()" *ngIf="slideActiveIndex == 0">Escolher plano</ion-button>

        <ion-button expand="block" (click)="next()" *ngIf="slideActiveIndex == 1"
          [disabled]="selectedPlanIndex === undefined">Confirmar plano</ion-button>

        <ion-button expand="block" (click)="pay()" *ngIf="slideActiveIndex == 2" [disabled]="formGroupCard.invalid">
          Confirmar pagamento</ion-button>

        <ion-button expand="block" (click)="dismiss()" *ngIf="slideActiveIndex == 3">Adicionar restaurante</ion-button>

      </ion-col>

    </ion-row>

  </ion-grid>

</ion-footer>

<ngx-loading [show]="loading"></ngx-loading>